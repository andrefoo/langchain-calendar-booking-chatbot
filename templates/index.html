<link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<!DOCTYPE html>
<html>
	<head>
		<title>Chatbot</title>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
		<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css')}}"/>
	</head>
	
	
	<body>
		<div class="container-fluid h-100 d-flex justify-content-center align-items-center">
			<div class="card">
				<div class="card-header msg_head">
					<div class="d-flex bd-highlight">
						<div class="img_cont">
							<img src="{{ url_for('static', filename='logo.png')}}" class="rounded-circle user_img">
							<span class="online_icon"></span>
						</div>
						<div class="user_info">
							<span>Andre's Calendar Scheduler Bot</span>
							<p>Make, Cancel, Reschedule, and Get Bookings on the Go!</p>
						</div>
					</div>
				</div>
				<div id="messageFormeight" class="card-body msg_card_body">
					
				</div>
				<div id="typing-indicator" class="d-none">
					<div class="d-flex justify-content-start mb-4">
						<div class="typing-indicator-container">
							<div class="typing-dots">
								<span></span>
								<span></span>
								<span></span>
							</div>
						</div>
					</div>
				</div>
				<div class="card-footer">
                    <form id="messageArea" method="post" action="{{ url_for('chat') }}">
                        <div class="input-group">
                            <input type="text" id="text" name="msg" placeholder="Type your message..." autocomplete="off" class="form-control type_msg" required/>
                            <div class="input-group-append">
                                <button type="submit" id="send" class="send_btn"><i class="fas fa-location-arrow"></i></button>
                            </div>
                        </div>
                    </form>
                </div>
			</div>
		</div>
		
		<script>
			document.getElementById('messageArea').onsubmit = function(event) {
				event.preventDefault();
				
				var form = event.target;
				var formData = new FormData(form);
				var messageContainer = document.getElementById('messageFormeight');
				
				// Immediately create and append the user message
				var userMessage = document.createElement('div');
				userMessage.className = 'message-wrapper';
				userMessage.innerHTML = '<div class="msg_cotainer_send">' + form.msg.value + '</div>';
				messageContainer.appendChild(userMessage);
				
				// Scroll to the bottom after adding user message
				messageContainer.scrollTop = messageContainer.scrollHeight;
				
				// Clear the input field
				form.reset();
				
				// Show typing indicator
				var typingIndicator = document.getElementById('typing-indicator');
				typingIndicator.classList.remove('d-none');
				
				fetch(form.action, {
					method: 'POST',
					body: formData
				})
				.then(response => response.json())
				.then(data => {
					// Hide typing indicator
					typingIndicator.classList.add('d-none');
					
					// Create and append the bot message
					var botMessage = document.createElement('div');
					botMessage.className = 'message-wrapper';
					botMessage.innerHTML = '<div class="msg_cotainer">' + data.response + '</div>';
					messageContainer.appendChild(botMessage);
					
					// Scroll to the bottom after adding bot message
					messageContainer.scrollTop = messageContainer.scrollHeight;
				})
				.catch(error => {
					console.error('Error:', error);
					// Hide typing indicator in case of error
					typingIndicator.classList.add('d-none');
				});
			};
		</script>
        
    </body>
</html>